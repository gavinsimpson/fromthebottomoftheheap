<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Dr. Gavin Simpson and Dr. Maria Davis" />


<title>Plant Physiology: N addition experiment</title>

<script src="index_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="index_files/bootstrap-3.3.5/css/united.min.css" rel="stylesheet" />
<script src="index_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="index_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="index_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="index_files/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="index_files/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="index_files/tocify-1.9.1/jquery.tocify.js"></script>
<script src="index_files/navigation-1.1/tabsets.js"></script>
<script src="index_files/accessible-code-block-0.0.1/empty-anchor.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-7900310-7"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-7900310-7');
</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Plant Physiology: N addition experiment</h1>
<h4 class="author">Dr. Gavin Simpson and Dr. Maria Davis</h4>
<h4 class="date">November 2020</h4>

</div>


<div id="this-file-is-hosted-at-bit.lybiol266nexp" class="section level4">
<h4>This file is hosted at: <a href="http://bit.ly/biol266nexp">bit.ly/biol266nexp</a></h4>
</div>
<div id="getting-started" class="section level1">
<h1>Getting started</h1>
<p>To get started, open your web browser, head to <a href="">rstudio.cloud</a> and log in using your RStudio Cloud account.</p>
<p>Once you have logged in, start a <strong>New Project</strong> by clicking the button to the right of “Your Projects”</p>
<p><img src="../images/rstudio-cloud-new-project-annotated.png" width="800px" /></p>
<p>After you click the button, <strong>rstudio.cloud</strong> will deploy a new RStudio instance, which may take a minute or two, so be patient.</p>
<p>Once the RStudio instance is running, rename your project by clicking on the “Untitled Project” label at the top of the screen. Give the project a useful name, such as “biol 266”.</p>
<p><img src="../images/rstudio-cloud-change-project-name-annotated.png" width="450px" /></p>
<div id="opening-a-new-script-window" class="section level2">
<h2>Opening a new script window</h2>
<p>It is good practice to enter your R code into a R script. An R script is a plain text file that we save with the extension <code>.R</code>. All your code for the lab should go in here because</p>
<ol style="list-style-type: decimal">
<li>you can save the file and all your work as you go along so you have a record of what you did,</li>
<li>it is easier to edit your code and fix errors, mistakes, or typos in the script window, and</li>
<li>you can share the script file if you need help to track down an error.</li>
</ol>
<p>To start a new script, go to the <strong>File</strong> menu, then select <strong>New File</strong> &gt; <strong>R Script</strong></p>
<p><img src="../images/rstudio-cloud-new-script.png" width="500px" /></p>
<p>Or you can press <kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>Alt</kbd> + <kbd>N</kbd> on Windows or <kbd>Cmd</kbd> + <kbd>Shift</kbd> + <kbd>Option</kbd> + <kbd>N</kbd> on a Mac.</p>
<p>Your RStudio screen should look like this</p>
<p><img src="../images/rstudio-cloud-screen-annotated.png" width="750px" /></p>
</div>
<div id="installing-r-packages" class="section level2">
<h2>Installing R Packages</h2>
<p>Once you have a new session running and named, click in the Console window by the <strong>prompt</strong> and run the code below by typing in the console exactly what is shown below and hitting <kbd>Return</kbd></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">install.packages</span>(<span class="kw">c</span>(<span class="st">&#39;purrr&#39;</span>, <span class="st">&#39;readxl&#39;</span>, <span class="st">&#39;tidyr&#39;</span>, <span class="st">&#39;dplyr&#39;</span>, <span class="st">&#39;forcats&#39;</span>,</span>
<span id="cb1-2"><a href="#cb1-2"></a>                   <span class="st">&#39;ggplot2&#39;</span>, <span class="st">&#39;tibble&#39;</span>, <span class="st">&#39;stringr&#39;</span>, <span class="st">&#39;emmeans&#39;</span>))</span></code></pre></div>
<p>This will take a few minutes to complete.</p>
</div>
<div id="load-packages" class="section level2">
<h2>Load Packages</h2>
<p>We need to load the packages we just installed so they are ready to use. You need to do this each time you start R and want to use these packages. The installation step you just performed does <em>not</em> need to be each time you start R.</p>
<p>Click in the <strong>script</strong> window. Enter the lines of code below into the script window. The hash character <code>#</code> allows you to enter comments, which R will ignore.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">library</span>(<span class="st">&#39;purrr&#39;</span>)</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="kw">library</span>(<span class="st">&#39;readxl&#39;</span>)  <span class="co"># read from Excel sheets</span></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="kw">library</span>(<span class="st">&#39;tidyr&#39;</span>)   <span class="co"># data processing</span></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="kw">library</span>(<span class="st">&#39;dplyr&#39;</span>)   <span class="co"># mo data processing</span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="kw">library</span>(<span class="st">&#39;forcats&#39;</span>) <span class="co"># mo mo data processing</span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="kw">library</span>(<span class="st">&#39;tibble&#39;</span>)  <span class="co"># creating data frames</span></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="kw">library</span>(<span class="st">&#39;stringr&#39;</span>) <span class="co"># process strings (text)</span></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="kw">library</span>(<span class="st">&#39;ggplot2&#39;</span>) <span class="co"># plotting</span></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="kw">library</span>(<span class="st">&#39;emmeans&#39;</span>) <span class="co"># for post hoc comparisons</span></span>
<span id="cb2-10"><a href="#cb2-10"></a></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="kw">theme_set</span>(<span class="kw">theme_bw</span>()) <span class="co"># Set plot theme</span></span></code></pre></div>
<p>Once you have entered all those lines of code into the script window, move the cursor to the first line or click on it, and then press the following keys:</p>
<ul>
<li>On Windows press <kbd>Ctrl</kbd> + <kbd>Enter</kbd></li>
<li>On Mac press <kbd>Cmd</kbd> + <kbd>Enter</kbd></li>
</ul>
<p>This will send the current line of code to the <strong>console</strong> window and move cursor to the start of the next line. Continue hitting <kbd>Ctrl</kbd> + <kbd>Enter</kbd> or <kbd>Cmd</kbd> + <kbd>Enter</kbd> until you have sent each line of code into the console. As you do so, R will load each package; some messages will be printed to the console, but this is OK as long as you do not see any <strong>Errors</strong>.</p>
<p>From now on, enter the code in the shaded grey boxes into the <strong>Script</strong> window and use <kbd>Ctrl</kbd> + <kbd>Enter</kbd> or <kbd>Cmd</kbd> + <kbd>Enter</kbd> to send the code to the <strong>Console</strong>. Whenever R produces output, it should match (or be similar to; you will see output for your data) the text shown in the outlined boxes where each line starts with <code>##</code>.</p>
<p><em>Note that the output in the console <strong>won’t</strong> have the</em> <code>##</code><em>, these are just to indicate <strong>output</strong> in this document.</em></p>
</div>
<div id="upload-data" class="section level2">
<h2>Upload data</h2>
<p>Before we can work with the data from the experiment, we will need to upload them to our <strong>rstudio.cloud</strong> project. Make sure you have downloaded the <code>rn266data.xlsx</code> file from UR Courses and that you have it somewhere on your local computer. Next, make sure the <strong>Files</strong> tab is selected in the lower right quarter of the application, and locate the <strong>Upload</strong> button</p>
<p><img src="../images/rstudio-cloud-screen-upload-button.png" width="750px" /></p>
<p>Click the <strong>Upload</strong> button — this will bring up the <strong>Upload files</strong> dialogue box</p>
<p><img src="../images/rstudio-cloud-screen-upload-dialog.png" width="350px" /></p>
<p>Click the <strong>Choose file</strong> button — this will bring up the file chooser on your computer. In the file chooser, navigate to where you saved the <code>rn266data.xlsx</code> file and open it in the chooser so that the file is listed next to the <strong>Choose file</strong> button, as shown below</p>
<p><img src="../images/rstudio-cloud-screen-upload-dialog-filled-added-n.png" width="350px" /></p>
<p>Once you have <code>rn266data.xlsx</code> showing in the dialogue box, you can click <strong>OK</strong> to upload the file to <strong>rstudio.cloud</strong>.</p>
<p>When you have uploaded the file, your <strong>Files</strong> pane should list the <code>rn266data.xlsx</code> file as shown below</p>
<p><img src="../images/rstudio-cloud-screen-upload-complete-added-n.png" width="350px" /></p>
</div>
<div id="saving-your-work" class="section level2">
<h2>Saving your work</h2>
<p>At this point, it is worth saving your script. Find the single disk icons in the main menu or the menu for your script</p>
<p><img src="../images/rstudio-cloud-screen-save-script.png" width="750px" /></p>
<p>Click either of these icons to save the file. The first time you do this you’ll be prompted to enter a file name — use something memorable and be sure to give it the extension <code>.R</code>. In the image below I named my script <code>biol266-n-exp.R</code>.</p>
<p><img src="../images/rstudio-cloud-screen-save-script-dialog.png" width="350px" /></p>
<p>Then click <strong>Save</strong>.</p>
<p>Be sure to save your work regularly during class. You can use <kbd>Ctrl</kbd> + <kbd>s</kbd> on Windows and <kbd>Cmd</kbd> + <kbd>s</kbd> on Mac to save changes you make to your script, or click on the disk icon as before.</p>
</div>
</div>
<div id="load-data" class="section level1">
<h1>Load Data</h1>
<p>The experimental data exist in <code>rn266data.xlsx</code>, an Excel workbook. We’re going to work with all the data collected by everyone that took part in the experiment. To do this, we need to load the data from each sheet in turn, which we do with an iterator using the <code>map()</code> function to call <code>read_excel()</code> on each sheet name in turn</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>sheets &lt;-<span class="st"> </span><span class="kw">excel_sheets</span>(path) <span class="op">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="st">    </span><span class="kw">set_names</span>()</span>
<span id="cb3-3"><a href="#cb3-3"></a>plants &lt;-<span class="st"> </span><span class="kw">map</span>(sheets, read_excel, <span class="dt">path =</span> <span class="st">&quot;rn266data.xlsx&quot;</span>)</span></code></pre></div>
<p>We need to do a little cleaning of the data before we can cbine all the sheets into a single object for analysis. The data cleaning requires a couple of functions</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co">## fixes the sheet names to clean the up a bit </span></span>
<span id="cb4-2"><a href="#cb4-2"></a>fix_names &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb4-3"><a href="#cb4-3"></a>    nms &lt;-<span class="st"> </span><span class="kw">names</span>(x) <span class="op">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="st">        </span><span class="kw">str_trim</span>(<span class="dt">side =</span> <span class="st">&quot;right&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="st">        </span><span class="kw">str_to_lower</span>() <span class="op">%&gt;%</span></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="st">        </span><span class="kw">str_replace_all</span>(<span class="dt">pattern =</span> <span class="st">&quot;: &quot;</span>, <span class="dt">replacement =</span> <span class="st">&quot;:&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="st">        </span><span class="kw">str_replace_all</span>(<span class="dt">pattern =</span> <span class="st">&quot;heatlh&quot;</span>, <span class="dt">replacement =</span> <span class="st">&quot;health&quot;</span>)</span>
<span id="cb4-8"><a href="#cb4-8"></a>    <span class="kw">names</span>(x) &lt;-<span class="st"> </span>nms</span>
<span id="cb4-9"><a href="#cb4-9"></a>    x</span>
<span id="cb4-10"><a href="#cb4-10"></a>}</span>
<span id="cb4-11"><a href="#cb4-11"></a></span>
<span id="cb4-12"><a href="#cb4-12"></a><span class="co">## wrapper around the two pivot operations needed to get the data</span></span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="co">## we want them</span></span>
<span id="cb4-14"><a href="#cb4-14"></a>pivot_fun &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb4-15"><a href="#cb4-15"></a>    x &lt;-<span class="st"> </span><span class="kw">pivot_longer</span>(x,</span>
<span id="cb4-16"><a href="#cb4-16"></a>                      <span class="op">-</span>(treatment<span class="op">:</span>plantid),</span>
<span id="cb4-17"><a href="#cb4-17"></a>                      <span class="dt">names_to =</span> <span class="kw">c</span>(<span class="st">&quot;variable&quot;</span>, <span class="st">&quot;day&quot;</span>),</span>
<span id="cb4-18"><a href="#cb4-18"></a>                      <span class="dt">names_sep =</span> <span class="st">&#39;:&#39;</span>,</span>
<span id="cb4-19"><a href="#cb4-19"></a>                      <span class="dt">names_transform =</span> <span class="kw">list</span>(<span class="dt">day =</span> as.integer))</span>
<span id="cb4-20"><a href="#cb4-20"></a>    x &lt;-<span class="st"> </span><span class="kw">pivot_wider</span>(x, <span class="dt">names_from =</span> variable, <span class="dt">values_from =</span> value)</span>
<span id="cb4-21"><a href="#cb4-21"></a>    x &lt;-<span class="st"> </span><span class="kw">mutate</span>(x, <span class="dt">id =</span> <span class="kw">paste</span>(treatment, plantid, <span class="dt">sep =</span> <span class="st">&#39;_&#39;</span>))</span>
<span id="cb4-22"><a href="#cb4-22"></a>    x &lt;-<span class="st"> </span><span class="kw">mutate</span>(x, <span class="dt">treatment =</span> <span class="kw">fct_relevel</span>(treatment, <span class="st">&#39;control&#39;</span>))</span>
<span id="cb4-23"><a href="#cb4-23"></a>    x</span>
<span id="cb4-24"><a href="#cb4-24"></a>}</span></code></pre></div>
<p>Copy and paste these functions into your script and then highlight them in the script and run them within R so that thay are available for use in your session.</p>
<p>Now we can clean up the column names in the sheets</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>plants &lt;-<span class="st"> </span><span class="kw">map</span>(plants, fix_names)</span></code></pre></div>
<p>and finally do the two pivot operations you saw in the lab analysis videos, to get the data exactly how we want them</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>plants &lt;-<span class="st"> </span><span class="kw">map</span>(plants, pivot_fun)</span></code></pre></div>
<p>Next we need to combine all of the processed data objects in <code>plants</code> into a single data frame, rather than a list of separate data frames as it is currently. We start by stroing some info about the sheets and how many rows of data each has</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>sheet_names &lt;-<span class="st"> </span><span class="kw">names</span>(plants) <span class="co"># names of sheets</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>obs_per_sheet &lt;-<span class="st"> </span><span class="kw">map</span>(plants, nrow) <span class="co"># how many obs ber sheet</span></span></code></pre></div>
<p>then we combine the sheets and add in an extra variable <code>observer</code> (who did the experiment), as well as modifying the <code>id</code> variable and setting the reference level of the <code>treatment</code> factor to be the <code>control</code> level.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>plants &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(plants) <span class="op">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">observer =</span> <span class="kw">rep</span>(sheet_names, <span class="dt">times =</span> obs_per_sheet),</span>
<span id="cb8-3"><a href="#cb8-3"></a>           <span class="dt">id =</span> <span class="kw">paste</span>(observer, id, <span class="dt">sep =</span> <span class="st">&#39;_&#39;</span>),</span>
<span id="cb8-4"><a href="#cb8-4"></a>           <span class="dt">treatment =</span> <span class="kw">fct_relevel</span>(treatment, <span class="st">&#39;control&#39;</span>))</span></code></pre></div>
<p>OK, that’s a lot of data processing. Let’s look at the data.</p>
</div>
<div id="plant-height" class="section level1">
<h1>Plant height</h1>
<p>We can plot the plant height data over time using the following code</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw">ggplot</span>(plants, <span class="kw">aes</span>(<span class="dt">x =</span> day, <span class="dt">y =</span> height, <span class="dt">group =</span> id,</span>
<span id="cb9-2"><a href="#cb9-2"></a>                   <span class="dt">colour =</span> treatment)) <span class="op">+</span></span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>observer) <span class="op">+</span></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&#39;Height (mm)&#39;</span>, <span class="dt">x =</span> <span class="st">&#39;Day&#39;</span>, <span class="dt">colour =</span> <span class="st">&#39;Treatment&#39;</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 650 row(s) containing missing values (geom_path).</code></pre>
<p><img src="index_files/figure-html/plot-height-data-1.png" width="100%" /></p>
<p>Note, we specify the data object (<code>plants</code>) and the mapping of variables to axes and the colour channel. We want to group the data for each plant and draw lines through the observations to better show how the height of each plant changed over time. We indicate this grouping via the <code>group</code> aesthetic, which we set to the <code>id</code> variable we created earlier. We also draw the data for each observer in it’s own panel, which <em>ggplot</em> calls <em>faceting</em>. The final line adds some nice labels to the plot.</p>
<p>Some preliminary analysis suggests we need to model plant height on the log scale; bigger things get bigger more quickly than smaller things. As such we should look at the data on that scale too</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw">ggplot</span>(plants, <span class="kw">aes</span>(<span class="dt">x =</span> day, <span class="dt">y =</span> <span class="kw">log1p</span>(height), <span class="dt">group =</span> id,</span>
<span id="cb11-2"><a href="#cb11-2"></a>                   <span class="dt">colour =</span> treatment)) <span class="op">+</span></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>observer) <span class="op">+</span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="kw">expression</span>(log[e](Height) <span class="op">~</span><span class="st"> </span>(log[e]<span class="op">*</span>mm)), <span class="dt">x =</span> <span class="st">&#39;Day&#39;</span>, <span class="dt">colour =</span> <span class="st">&#39;Treatment&#39;</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 650 row(s) containing missing values (geom_path).</code></pre>
<p><img src="index_files/figure-html/plot-log-height-data-1.png" width="100%" /></p>
<p>The <code>log1p()</code> function adds 1 to each observation of plant height before taking logs, as there are some <code>0</code> height plants. The value <code>log(0)</code> is minus infinity, something thats not a helpful number and which can’t easily be represented in the computer in a way that we can include it in the model. Hence adding 1 to all values means we have no zero values in the data before we log transform them.</p>
<p>The final thing we’ll do before we start analysing the data, just to simplify things, is to take only those rows of data where we have a height measurement, excluding all the <code>NA</code> values in the <code>height</code> variable. We do this by filtering the <code>plants</code> object</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>plant_h &lt;-<span class="st"> </span>plants <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(height)) </span></code></pre></div>
<div id="ancova" class="section level2">
<h2>ANCOVA</h2>
<p>The model we are fitting is sometimes called an <em>analysis of covariance</em> or ANCOVA, which is another special case of a linear model that can also be fitted using the <code>lm()</code> function. In an ANCOVA, we <em>control</em> for the effects of a continuous variable whilst interest is on a categorical treatment effect.</p>
<div id="potential-results" class="section level3">
<h3>Potential results</h3>
<p>As before, it is helpful to think about the kinds of result we might expect from the statistical analysis. When considering the <em>plant height</em> data we could think of <strong>five</strong> basic types of result:</p>
<p><img src="index_files/figure-html/ancova-hypo-examples-1.png" width="1440" /></p>
<p>We specify the model structure using a symbolic formula. The formula we’ll use is</p>
<pre><code>height ~ day * treatment + observer</code></pre>
<p>The response (dependent) variable is on the left hand side of the <code>~</code> (the tilde symbol). This is the variable we wish to explain. The right hand side of the formula contains the independent variables in the model. Here, the independent variables represent the experimental setup. In addition we have <code>+ observer</code>, which allows for a different mean plant height for each observer; we do this as there are likely to be differences between each student’s experimental set-up (temperature, amount of light, soil, etc) that will lead to systematic variation between observers. In a more formal analysis, we’d handle this using what are known as <em>random effects</em>, but here we keep things simple and just consider <code>observer</code> as a fixed offset and we don’t investigate any interactions between the experimental variables and <code>observer</code>, although that could be done.</p>
<p>Given our experimental design, the most complex model we can fit is one that allows for different growth rates (effects of <code>day</code>) for each treatment level. In other words we want to have a different growth rate for each combination of treatment.</p>
<p>Such a model implies a two-way interaction between <code>day</code>, and <code>treatment</code>. We indicate interactions in the formula using the <code>*</code> symbol.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>m1 &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log1p</span>(height) <span class="op">~</span><span class="st"> </span>day <span class="op">*</span><span class="st"> </span>treatment <span class="op">+</span><span class="st"> </span>observer, <span class="dt">data =</span> plant_h)</span></code></pre></div>
<p>As with the plot above, we are modelling <code>log1p(height)</code>, which adds <code>1</code> to each height observation before applying a log transformation.</p>
<p>We can summarize the model to look for some key diagnostics of the fit</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="kw">summary</span>(m1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = log1p(height) ~ day * treatment + observer, data = plant_h)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -3.8584 -0.2474  0.0955  0.3959  1.3116 
## 
## Coefficients:
##                  Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)      2.348031   0.083498  28.121  &lt; 2e-16 ***
## day              0.087206   0.003517  24.797  &lt; 2e-16 ***
## treatment1x      0.018353   0.081643   0.225  0.82216    
## treatment3x     -0.245240   0.081264  -3.018  0.00258 ** 
## observerAH       1.161503   0.083345  13.936  &lt; 2e-16 ***
## observerALi      0.532873   0.085831   6.208 6.44e-10 ***
## observerCC       1.517712   0.085973  17.653  &lt; 2e-16 ***
## observerHB       0.011267   0.085090   0.132  0.89467    
## observerHG      -1.068374   0.082880 -12.891  &lt; 2e-16 ***
## observerJC       0.357956   0.078808   4.542 5.89e-06 ***
## observerJE       0.892810   0.083166  10.735  &lt; 2e-16 ***
## observerJL       0.892757   0.075715  11.791  &lt; 2e-16 ***
## observerKK       0.599455   0.075709   7.918 3.89e-15 ***
## observerLZ       0.449775   0.080785   5.568 2.92e-08 ***
## observerMF      -0.588969   0.082718  -7.120 1.48e-12 ***
## observerMM       0.429434   0.080524   5.333 1.07e-07 ***
## observerNW       1.073622   0.081501  13.173  &lt; 2e-16 ***
## observerTC       1.034075   0.081634  12.667  &lt; 2e-16 ***
## observerTH       0.795451   0.080720   9.854  &lt; 2e-16 ***
## day:treatment1x -0.008454   0.004877  -1.733  0.08319 .  
## day:treatment3x -0.007639   0.004896  -1.560  0.11886    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.6347 on 2087 degrees of freedom
## Multiple R-squared:  0.626,  Adjusted R-squared:  0.6224 
## F-statistic: 174.7 on 20 and 2087 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Most of this isn’t very helpful in this state, except the omnibus <em>F</em> test which indicates if the total variance explained by all the model terms is significantly large relative to the unexplained variance.</p>
</div>
</div>
<div id="polynomial-regression" class="section level2">
<h2>Polynomial regression</h2>
<p>If we think back to the plot of the data we made earlier, the relationship between plant height and time was non-linear, even on the log scale. The model we just fitted is a linear model, only capable of fitting straight lines and as such is not likely to follow the data closely. Statisticians call this <strong>bias</strong>. To try to reduce the bias we can fit a non-linear curve to the data using polynomials of <code>day</code>. Polynomials are <span class="math inline">\(day\)</span>, <span class="math inline">\(day^2\)</span>, <span class="math inline">\(day^3\)</span>, etc. To model a saturating curve — one which levels off — we might be able to simply us <span class="math inline">\(\text{day} + \text{day}^2\)</span>, but to allow for decreasing height at later days we will use a cubic polynomial, <span class="math inline">\(\text{day}^3\)</span> as well. We can then compare all three models with increasing amounts of non-linearity and see which fits the data better.</p>
<p>First we create the polynomial models my updating the existing model. First we add first and second order polynomials and their interaction with <code>treatment</code>, which requires us to remove the <code>day * treatment</code> terms from the original model</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>m2 &lt;-<span class="st"> </span><span class="kw">update</span>(m1, . <span class="op">~</span><span class="st"> </span><span class="kw">poly</span>(day, <span class="dv">2</span>) <span class="op">*</span><span class="st"> </span>treatment <span class="op">+</span><span class="st"> </span>observer)</span></code></pre></div>
<p>Next we repeat the above but this time adding the third-degree polynomial</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>m3 &lt;-<span class="st"> </span><span class="kw">update</span>(m1, . <span class="op">~</span><span class="st"> </span><span class="kw">poly</span>(day, <span class="dv">3</span>) <span class="op">*</span><span class="st"> </span>treatment <span class="op">+</span><span class="st"> </span>observer)</span></code></pre></div>
<p>Now we have three models, we can compare them using an analysis of variance table or Akaike’s Information Criterion (AIC). We start with the analysis of variance table</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="kw">anova</span>(m1, m2, m3)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: log1p(height) ~ day * treatment + observer
## Model 2: log1p(height) ~ poly(day, 2) + treatment + observer + poly(day, 
##     2):treatment
## Model 3: log1p(height) ~ poly(day, 3) + treatment + observer + poly(day, 
##     3):treatment
##   Res.Df    RSS Df Sum of Sq       F    Pr(&gt;F)    
## 1   2087 840.79                                   
## 2   2084 710.92  3    129.87 134.402 &lt; 2.2e-16 ***
## 3   2081 670.28  3     40.64  42.058 &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Here we are comparing the models sequentially from simplest to most complex. Each line is testing if the next most complex model is similar to the next in terms of the residual sums of squares (<code>RSS</code>), which will decrease as we make the model more complex. We see significant reductions in the <code>RSS</code> (lack of fit of the model) as we add the extra polynomial terms, suggesting that the cubic polynomial of <code>day</code> gives the best fit to the data.</p>
<p>We confirm this using AIC, where smaller values of AIC indicate better-fitting models</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="kw">AIC</span>(m1, m2, m3)</span></code></pre></div>
<pre><code>##    df      AIC
## m1 22 4088.661
## m2 25 3740.974
## m3 28 3622.887</code></pre>
<p>Again, we find that the cubic polynomial provides the better fit. As such, we will use this model, <code>m3</code> to explore in more detail how plant height varied across the experimental period.</p>
</div>
<div id="treatments-vs-controls" class="section level2">
<h2>Treatments vs controls</h2>
<p>To get more interpretable output we will again use estimate marginal means; remember that we are interested in the effect of <code>day</code>, a continuous variable, as well as the treatment effects. The <code>day</code> effect will be represented by curved lines (regression lines), the slopes of which reflect the average growth rate of plants in the combinations of treatments and cultivars. Because the lines are not linear, the rate of growth varies throughout the experimental period. These lines are often called <em>trends</em> hence we use the <code>emtrends()</code> function to estimate the marginal trends instead of the marginal means.</p>
<p>As before we will start by comparing the treated plants with the control plants. This time however we need to indicate the <em>trend</em> variable via argument <code>var</code>. In our case the trend variable is <code>day</code> (which is indicated by the name in quotes). We also want the growth rate on the original (not log) scale, so we add <code>transform = "response"</code>, and because the growth rate is not constant we ask for the comparison of treatments at day <em>5</em></p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>m3mt5 &lt;-<span class="st"> </span><span class="kw">emtrends</span>(m3, trt.vs.ctrl <span class="op">~</span><span class="st"> </span>treatment, <span class="dt">var =</span> <span class="st">&quot;day&quot;</span>,</span>
<span id="cb24-2"><a href="#cb24-2"></a>                  <span class="dt">transform =</span> <span class="st">&quot;response&quot;</span>,</span>
<span id="cb24-3"><a href="#cb24-3"></a>                  <span class="dt">at =</span> <span class="kw">list</span>(<span class="dt">day =</span> <span class="dv">5</span>))</span>
<span id="cb24-4"><a href="#cb24-4"></a>m3mt5</span></code></pre></div>
<pre><code>## $emtrends
##  treatment day.trend     SE   df lower.CL upper.CL
##  control       0.300 0.0165 2081    0.268    0.333
##  1x            0.259 0.0171 2081    0.225    0.292
##  3x            0.281 0.0169 2081    0.248    0.314
## 
## Results are averaged over the levels of: observer 
## Confidence level used: 0.95 
## 
## $contrasts
##  contrast     estimate     SE   df t.ratio p.value
##  1x - control  -0.0418 0.0235 2081 -1.780  0.1377 
##  3x - control  -0.0195 0.0234 2081 -0.832  0.6126 
## 
## Results are averaged over the levels of: observer 
## P value adjustment: dunnettx method for 2 tests</code></pre>
<p>You should be familiar with this output now. The <code>$emtrends</code> section contains similar outputs to the <code>$emmeans</code> sections we looked at earlier when analyzing the fresh weight of the plants. The main difference is in the interpretation of the numbers in the <code>day.trend</code> column, which replaces the <code>emmean</code> from before. The <code>day.trend</code> column contains estimates of the slope of the regression line for the <code>day</code> variable at <code>day == 5</code>.</p>
<p>The numbers in the column are the estimated <em>change in the height</em> of the plant for a single day of growth:</p>
<ul>
<li>If the <code>day.trend</code> number is positive it means the plants in a treatment group increased in height over the experiment, and</li>
<li>if the <code>day.trend</code> number is negative it means the plants in a treatment group decreased in height over the experiment.</li>
</ul>
<p>The <code>$contrasts</code> section contains the same kind of comparisons of a treatments vs controls. Remember here that the <code>estimate</code> column contains the estimated difference in the slopes (growth rates) of the stated treatment and the control group. Hence the null hypothesis being tested is that the <em>difference in slopes is equal to zero</em>.</p>
<ul>
<li>A negative value in the <code>estimate</code> column means the average change in height in the stated treatment was lower than in the control group. In other words, the plants in that treatment group grew <em>more slowly</em> on average than the plants in the control group, and</li>
<li>A positive value in the <code>estimate</code> column means the plants in the that treatment group grew, on average, at a faster rate than plants in the control group.</li>
</ul>
<p>As before, we can plot these estimated marginal trends using the <code>plot()</code> method:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="kw">plot</span>(m3mt5, <span class="dt">comparisons =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/plot-treatment-v-control-1.png" width="672" /></p>
<p>This plot is similar to one we created in the earlier lab when we looked the data from the 2019 experiment:</p>
<ul>
<li>the black points are the estimated growth rates (regression slopes) for each treatment group,</li>
<li>the 95% confidence interval around the estimated growth rate is shown by the pale blue bar, and</li>
<li>the red arrows are approximate pairwise comparison regions — if arrows for a pair of treatments overlap one another we fail to reject the null hypothesis of equal growth rates for plants in the two treatments.</li>
</ul>
<p>The main difference in this plot is that we no longer show the estimated marginal mean on the <em>x</em> axis. Instead the slope of the regression line (the growth rate) is plotted on the <em>x</em> axis. Remember how we interpret these numbers: the values are the estimated <em>change</em>, on average, in the height of a plant in single day of growth.</p>
<p>It look like there is little evidence in favor of different treatment effects at day 5. What about at a point later in the experiment? We can try <code>day == 10</code> for example</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>m3mt10 &lt;-<span class="st"> </span><span class="kw">emtrends</span>(m3, trt.vs.ctrl <span class="op">~</span><span class="st"> </span>treatment,</span>
<span id="cb27-2"><a href="#cb27-2"></a>                   <span class="dt">var =</span> <span class="st">&quot;day&quot;</span>,</span>
<span id="cb27-3"><a href="#cb27-3"></a>                   <span class="dt">transform =</span> <span class="st">&quot;response&quot;</span>,</span>
<span id="cb27-4"><a href="#cb27-4"></a>                   <span class="dt">at =</span> <span class="kw">list</span>(<span class="dt">day =</span> <span class="dv">10</span>))</span>
<span id="cb27-5"><a href="#cb27-5"></a>m3mt10</span></code></pre></div>
<pre><code>## $emtrends
##  treatment day.trend      SE   df lower.CL upper.CL
##  control       0.148 0.00579 2081    0.137    0.160
##  1x            0.131 0.00591 2081    0.119    0.142
##  3x            0.125 0.00588 2081    0.114    0.137
## 
## Results are averaged over the levels of: observer 
## Confidence level used: 0.95 
## 
## $contrasts
##  contrast     estimate      SE   df t.ratio p.value
##  1x - control  -0.0180 0.00815 2081 -2.205  0.0523 
##  3x - control  -0.0233 0.00814 2081 -2.867  0.0082 
## 
## Results are averaged over the levels of: observer 
## P value adjustment: dunnettx method for 2 tests</code></pre>
<p>Look at the <code>$contrasts</code> component and see if there are significant differences at this point in the experiment.</p>
<p>As before, we can plot these estimated marginal trends using the <code>plot()</code> method:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="kw">plot</span>(m3mt10, <span class="dt">comparisons =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/plot-treatment-v-control-10-1.png" width="672" /></p>
<p>You can repeat these commands for different days in the experimental period.</p>
<p>All this talk of estimated trends or slopes may be a little opaque, but we can plot the estimated regression lines to visualize the average growth rates of plants in each of the treatment groups using the <code>emmip()</code> function:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="kw">emmip</span>(m3, treatment <span class="op">~</span><span class="st"> </span>day, <span class="dt">cov.reduce =</span> <span class="ot">FALSE</span>, <span class="dt">CIs =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/height-plot-estimated-slopes-1.png" width="672" /></p>
<p>Here the formula means you want to show the <code>treatment</code> effects against <code>day</code>. The <code>cov.reduce = FALSE</code> part means that we want to plot for all values of <code>day</code> so that we get the full regression lines. Confidence intervals are added with <code>CIs = TRUE</code> — if you want to turn them off use <code>CIs = FALSE</code>.</p>
</div>
<div id="pairwise-comparisons" class="section level2">
<h2>Pairwise comparisons</h2>
<p>If you want formal comparisons of the growth rates for all pairs of treatments, we can also do all pairwise comparisons using the <code>emmtrends()</code>function by using the <code>pairwise</code> option instead of <code>trt-vs-ctrl</code>. As before, we can assess the estimate growth rate (slope) at a given day, here for <code>day == 5</code></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="kw">emtrends</span>(m3, pairwise <span class="op">~</span><span class="st"> </span>treatment,</span>
<span id="cb31-2"><a href="#cb31-2"></a>         <span class="dt">var =</span> <span class="st">&quot;day&quot;</span>,</span>
<span id="cb31-3"><a href="#cb31-3"></a>         <span class="dt">transform =</span> <span class="st">&quot;response&quot;</span>,</span>
<span id="cb31-4"><a href="#cb31-4"></a>         <span class="dt">at =</span> <span class="kw">list</span>(<span class="dt">day =</span> <span class="dv">5</span>))</span></code></pre></div>
<pre><code>## $emtrends
##  treatment day.trend     SE   df lower.CL upper.CL
##  control       0.300 0.0165 2081    0.268    0.333
##  1x            0.259 0.0171 2081    0.225    0.292
##  3x            0.281 0.0169 2081    0.248    0.314
## 
## Results are averaged over the levels of: observer 
## Confidence level used: 0.95 
## 
## $contrasts
##  contrast     estimate     SE   df t.ratio p.value
##  control - 1x   0.0418 0.0235 2081  1.780  0.1765 
##  control - 3x   0.0195 0.0234 2081  0.832  0.6830 
##  1x - 3x       -0.0224 0.0238 2081 -0.939  0.6155 
## 
## Results are averaged over the levels of: observer 
## P value adjustment: tukey method for comparing a family of 3 estimates</code></pre>
<p>and for <code>day == 20</code></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="kw">emtrends</span>(m3, pairwise <span class="op">~</span><span class="st"> </span>treatment,</span>
<span id="cb33-2"><a href="#cb33-2"></a>         <span class="dt">var =</span> <span class="st">&quot;day&quot;</span>,</span>
<span id="cb33-3"><a href="#cb33-3"></a>         <span class="dt">transform =</span> <span class="st">&quot;response&quot;</span>,</span>
<span id="cb33-4"><a href="#cb33-4"></a>         <span class="dt">at =</span> <span class="kw">list</span>(<span class="dt">day =</span> <span class="dv">20</span>))</span></code></pre></div>
<pre><code>## $emtrends
##  treatment day.trend      SE   df lower.CL upper.CL
##  control      0.0204 0.00545 2081  0.00972   0.0311
##  1x           0.0262 0.00542 2081  0.01553   0.0368
##  3x           0.0232 0.00555 2081  0.01234   0.0341
## 
## Results are averaged over the levels of: observer 
## Confidence level used: 0.95 
## 
## $contrasts
##  contrast     estimate      SE   df t.ratio p.value
##  control - 1x -0.00575 0.00762 2081 -0.755  0.7307 
##  control - 3x -0.00282 0.00770 2081 -0.366  0.9288 
##  1x - 3x       0.00293 0.00767 2081  0.382  0.9226 
## 
## Results are averaged over the levels of: observer 
## P value adjustment: tukey method for comparing a family of 3 estimates</code></pre>
<p>We don’t see any differences in the estimated growth rates, but are there differences in the average plant height between the two treatments? We can test that using the <code>emmeans()</code> function, again using the <code>pairwise</code> option instead of <code>trt-vs-ctrl</code>. We use <code>emmeans()</code> here because we want estimates of the expected mean height for each treatment at a set of days, and not the slope of a trend line.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="kw">emmeans</span>(m3, pairwise <span class="op">~</span><span class="st"> </span>treatment <span class="op">|</span><span class="st"> </span>day,</span>
<span id="cb35-2"><a href="#cb35-2"></a>        <span class="dt">at =</span> <span class="kw">list</span>(<span class="dt">day =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>)))</span></code></pre></div>
<pre><code>## Note: Use &#39;contrast(regrid(object), ...)&#39; to obtain contrasts of back-transformed estimates</code></pre>
<pre><code>## $emmeans
## day =  1:
##  treatment emmean     SE   df lower.CL upper.CL
##  control     1.36 0.1271 2081    1.108     1.61
##  1x          1.59 0.1335 2081    1.330     1.85
##  3x          1.19 0.1308 2081    0.938     1.45
## 
## day =  5:
##  treatment emmean     SE   df lower.CL upper.CL
##  control     2.88 0.0473 2081    2.783     2.97
##  1x          2.89 0.0493 2081    2.798     2.99
##  3x          2.66 0.0478 2081    2.561     2.75
## 
## day = 10:
##  treatment emmean     SE   df lower.CL upper.CL
##  control     3.98 0.0354 2081    3.906     4.05
##  1x          3.85 0.0348 2081    3.780     3.92
##  3x          3.64 0.0353 2081    3.574     3.71
## 
## day = 15:
##  treatment emmean     SE   df lower.CL upper.CL
##  control     4.46 0.0304 2081    4.402     4.52
##  1x          4.29 0.0298 2081    4.229     4.35
##  3x          4.03 0.0307 2081    3.966     4.09
## 
## day = 20:
##  treatment emmean     SE   df lower.CL upper.CL
##  control     4.63 0.0367 2081    4.555     4.70
##  1x          4.46 0.0361 2081    4.394     4.54
##  3x          4.15 0.0383 2081    4.079     4.23
## 
## Results are averaged over the levels of: observer 
## Results are given on the log1p (not the response) scale. 
## Confidence level used: 0.95 
## 
## $contrasts
## day =  1:
##  contrast     estimate     SE   df t.ratio p.value
##  control - 1x   -0.235 0.1820 2081 -1.290  0.4011 
##  control - 3x    0.163 0.1802 2081  0.903  0.6385 
##  1x - 3x         0.397 0.1845 2081  2.154  0.0795 
## 
## day =  5:
##  contrast     estimate     SE   df t.ratio p.value
##  control - 1x   -0.019 0.0671 2081 -0.283  0.9567 
##  control - 3x    0.220 0.0661 2081  3.336  0.0025 
##  1x - 3x         0.239 0.0675 2081  3.550  0.0011 
## 
## day = 10:
##  contrast     estimate     SE   df t.ratio p.value
##  control - 1x    0.127 0.0494 2081  2.582  0.0267 
##  control - 3x    0.332 0.0497 2081  6.686  &lt;.0001 
##  1x - 3x         0.205 0.0492 2081  4.156  0.0001 
## 
## day = 15:
##  contrast     estimate     SE   df t.ratio p.value
##  control - 1x    0.175 0.0424 2081  4.120  0.0001 
##  control - 3x    0.435 0.0431 2081 10.090  &lt;.0001 
##  1x - 3x         0.260 0.0427 2081  6.105  &lt;.0001 
## 
## day = 20:
##  contrast     estimate     SE   df t.ratio p.value
##  control - 1x    0.162 0.0512 2081  3.169  0.0044 
##  control - 3x    0.473 0.0527 2081  8.961  &lt;.0001 
##  1x - 3x         0.310 0.0522 2081  5.949  &lt;.0001 
## 
## Results are averaged over the levels of: observer 
## Note: contrasts are still on the log1p scale 
## P value adjustment: tukey method for comparing a family of 3 estimates</code></pre>
<p>There is a lot of output here, but it follows that which we have seen previously; The <code>$emmeans</code> component contains the point estimates of plant height for the three treatments for each of the requested days, while the <code>$contrasts</code> component shows the pairwise comparisons for the treatment.</p>
<p><strong>Are any of these pairwise comparisons statistically significant?</strong> <strong>Does which pairs of comparisons are significantly different change over time?</strong> <strong>What does this suggest about the effects of the treatment and the cultivar on the growth of the plants?</strong></p>
</div>
</div>
<div id="plant-health" class="section level1">
<h1>Plant health</h1>
<p>The plant health data are not as easily analyzed as the plant height data; <code>health</code> is an <em>ordered categorical</em> response and that requires a more specialized model, such as a proportional odds model or assuming an ordered categorical response distribution. These models are non-trivial and as such we won’t explore the <code>health</code> data statistically here although doing so is most certainly possible.</p>
<p>Instead, we’ll just look at the data, which you can describe.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="kw">ggplot</span>(plants, <span class="kw">aes</span>(<span class="dt">x =</span> day, <span class="dt">y =</span> health, <span class="dt">group =</span> id,</span>
<span id="cb38-2"><a href="#cb38-2"></a>                   <span class="dt">colour =</span> treatment)) <span class="op">+</span></span>
<span id="cb38-3"><a href="#cb38-3"></a><span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb38-4"><a href="#cb38-4"></a><span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>observer) <span class="op">+</span></span>
<span id="cb38-5"><a href="#cb38-5"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&#39;Health (1-5)&#39;</span>, <span class="dt">x =</span> <span class="st">&#39;Day&#39;</span>, <span class="dt">colour =</span> <span class="st">&#39;Treatment&#39;</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 624 row(s) containing missing values (geom_path).</code></pre>
<p><img src="index_files/figure-html/plot-health-1.png" width="672" /></p>
</div>
<div id="number-of-internodes" class="section level1">
<h1>Number of internodes</h1>
<p>We can analyse the number of internodes in a similar way to that for plant height, with an ANCOVA. The data can be plotted using</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="kw">ggplot</span>(plants, <span class="kw">aes</span>(<span class="dt">x =</span> day, <span class="dt">y =</span> <span class="kw">log1p</span>(internodes), <span class="dt">group =</span> id,</span>
<span id="cb40-2"><a href="#cb40-2"></a>                   <span class="dt">colour =</span> treatment)) <span class="op">+</span></span>
<span id="cb40-3"><a href="#cb40-3"></a><span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb40-4"><a href="#cb40-4"></a><span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>observer) <span class="op">+</span></span>
<span id="cb40-5"><a href="#cb40-5"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&#39;Number of internodes&#39;</span>, <span class="dt">x =</span> <span class="st">&#39;Day&#39;</span>, <span class="dt">colour =</span> <span class="st">&#39;Treatment&#39;</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 670 row(s) containing missing values (geom_path).</code></pre>
<p><img src="index_files/figure-html/plot-log-internodes-data-1.png" width="100%" /></p>
<p>First we filter the data</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a>plants_i &lt;-<span class="st"> </span><span class="kw">filter</span>(plants, <span class="op">!</span><span class="kw">is.na</span>(internodes))</span></code></pre></div>
<p>Then we fit the models, again allowing for polynomials of <code>day</code></p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a>i1 &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log1p</span>(internodes) <span class="op">~</span><span class="st"> </span>day <span class="op">*</span><span class="st"> </span>treatment <span class="op">+</span><span class="st"> </span>observer, <span class="dt">data =</span> plants_i)</span>
<span id="cb43-2"><a href="#cb43-2"></a>i2 &lt;-<span class="st"> </span><span class="kw">update</span>(i1, . <span class="op">~</span><span class="st"> </span><span class="kw">poly</span>(day, <span class="dv">2</span>) <span class="op">*</span><span class="st"> </span>treatment <span class="op">+</span><span class="st"> </span>observer)</span>
<span id="cb43-3"><a href="#cb43-3"></a>i3 &lt;-<span class="st"> </span><span class="kw">update</span>(i1, . <span class="op">~</span><span class="st"> </span><span class="kw">poly</span>(day, <span class="dv">3</span>) <span class="op">*</span><span class="st"> </span>treatment <span class="op">+</span><span class="st"> </span>observer)</span></code></pre></div>
<p>And finally we can compre these to see which fits the data best</p>
<p><code>{r anova-aic-internodes) anova(i1, i2, i3) AIC(i1, i2, i3)</code></p>
<p>Working from <code>i3</code> then, we repeat some of the <code>emtrends()</code> and <code>emmeans()</code> code we used earlier but applied to <code>i3</code> to investigate changes and difference in the number of internodes over time and between treatments.</p>
</div>
<div id="exporting-images-files" class="section level1">
<h1>Exporting images &amp; files</h1>
<p>To save a plot to a file, click on the <strong>Plots</strong> tab in the lower right window, and use the arrow icons to page through the plots to the one you want. Then click the <strong>Export</strong></p>
<p><img src="../images/rstudio-cloud-screen-export-button.png" width="750px" /></p>
<p>From the menu that appears choose <strong>Save as Image…</strong></p>
<p><img src="../images/rstudio-cloud-screen-export-image.png" width="750px" /></p>
<p>This brings up the <strong>Save Plot as Image</strong> dialogue box. Make the following changes:</p>
<ol style="list-style-type: decimal">
<li>In the <em>Image format</em> box, select <strong>PNG</strong></li>
<li>In the <em>File name</em> box enter the file name you want for the image, include the <code>.png</code> extension</li>
<li>Change the height and width to suit
<ul>
<li>You can set the height and width in pixel in the boxes to the top right of the dialogue box. If you change these you need to click the <em>Update Preview</em> button to redraw the plot</li>
<li>Alternatively, you can use the hotspot to the bottom right corner of the plot to drag to resize. Click the <em>Update Preview</em> button to redraw the plot to the desired size</li>
</ul></li>
</ol>
<p><img src="../images/rstudio-cloud-screen-export-image-dialog.png" width="750px" /></p>
<p>When you have made the required changes, click <strong>Save</strong>.</p>
<p>To export saved images or your script to your local machine, select the <strong>Files</strong> tab in the lower right window</p>
<p><img src="../images/rstudio-cloud-screen-export-files.png" width="750px" /></p>
<p>Check the boxes next to the files you wish to export (download) as shown above, and then click the <strong>More</strong> button in the menu and select the <strong>Export…</strong> option.</p>
<p><img src="../images/rstudio-cloud-screen-export-files-dialog.png" width="300px" /></p>
<p>Enter a filename — if you are exporting more than one file, <em>RStudio</em> will compress all the files into a single ZIP archive — if needed, but the provided name should be OK. Then click <strong>Download</strong> to download the file or the ZIP archive.</p>
</div>
<div id="logging-off" class="section level1">
<h1>Logging Off</h1>
<p>Your work will be saved in your <strong>rstudio.cloud</strong> workspace for some time after the lab. You will be able to resume from where you left off if you log in to your workspace at a late time. To be sure that the latest state of your work is saved, it would be best to log out of <strong>rstudio.cloud</strong> at the end of class today.</p>
<p>Locate your user name in the top right of the screen</p>
<p><img src="../images/rstudio-cloud-screen-logout-1.png" width="250px" /></p>
<p>Click your user name to open the menu</p>
<p><img src="../images/rstudio-cloud-screen-logout-2.png" width="500px" /></p>
<p>Click “Log out” to securely log out of <strong>rstudio.cloud</strong>.</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
